---
layout: post
title: Prism 开发笔记
date: 2022-11-17
catalog: true
tags: [C#]
---

# Prism 开发笔记

## 创建Common类存放各种类

比如说创建的菜单，可以在`Common`文件夹的`Models`文件夹中，创建一个`MenuBar.cs`类

## 创建Images文件夹用来存放图片

存入的图片需要在其属性中设置`生成操作`为`资源`才能正确引用

## View与Model的对应关系

一开始的`MainView`，与其一一对应的的`ViewMModel`应该命名为`MainViewModel`，才能正确被`Prism`框架识别和映射到

后面的可以在`App.xaml`中手动设置

## 使用主题来快速生成应用程序

直接在主题扩展的源码中复制需要的`.xaml`片段即可

## 创建Extensions文件夹，用来存放扩展类

比如说页面导航中的`PrismManager`，可以在`Extensions`文件夹中创建一个`PrismManager.cs`类来存放它

```c#
namespace MyToDo.Extensions
{
    public static class PrismManager
    {
        public static readonly string MainViewRegionName = "MainViewRegion";
    }
}
```

然后在页面的`xaml`文件中添加命名空间

```c#
        xmlns:ext="clr-namespace:MyToDo.Extensions"
```

## 使用控件模板来实现前端CSS中的各种高级操作

```c#
			<Style x:Key="MylistBoxItemStyle" TargetType="ListBoxItem">
                <Setter Property="MinHeight" Value="40"></Setter>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ListBoxItem">
                            <Grid>
                                <Border Name="borderHeader"></Border>
                                <Border Name="border"></Border>
                                <!-- 使得外部设置的有效 -->
                                <ContentPresenter VerticalAlignment="{TemplateBinding VerticalAlignment}" HorizontalAlignment="{TemplateBinding HorizontalAlignment}"/>
                            </Grid>
                            <ControlTemplate.Triggers>
                                <!-- 设置触发器，使得被选中时的左边框明显一点 -->
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="BorderThickness" TargetName="borderHeader" Value="6,0,0,0"></Setter>
                                    <Setter Property="BorderBrush" Value="{DynamicResource PrimaryHueLightBrush}" TargetName="borderHeader"></Setter>
                                    <Setter Property="FontWeight" Value="Bold"></Setter>
                                    <Setter Property="Background" Value="{DynamicResource PrimaryHueLightBrush}" TargetName="border"></Setter>
                                    <Setter Property="Opacity" TargetName="border" Value="0.2"></Setter>
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <!-- 背景颜色通过动态绑定，使得可以统一更改 -->
                                    <Setter Property="Background" Value="{DynamicResource PrimaryHueLightBrush}" TargetName="border"></Setter>
                                    <Setter Property="BorderBrush" Value="{DynamicResource PrimaryHueLightBrush}" TargetName="borderHeader"></Setter>
                                    <Setter Property="Opacity" TargetName="border" Value="0.2"></Setter>
                                </Trigger>
                            </ControlTemplate.Triggers>

                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
```

## 通过 behaviors 给触发器添加行为

对于ListBoxItem来说，无法像普通的控件一样，直接绑定命令，于是需要安装`Microsoft.Xaml.Behaviors.Wpf`包，然后给控件模板添加触发器，实现命令绑定

- 使用`nuget`安装`Microsoft.Xaml.Behaviors.Wpf`包

- 添加命名空间

  ```c#
  xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
  ```

- 添加触发器行为

  ```c#
  <ListBox Name="menuBar" ItemContainerStyle="{StaticResource MylistBoxItemStyle}" ItemsSource="{Binding MenuBars}" >
      <i:Interaction.Triggers>
          <i:EventTrigger EventName="SelectionChanged">
  			<i:InvokeCommandAction Command="{Binding NavigateCommand}" CommandParameter="{Binding ElementName=menuBar,Path=SelectedItem}">
              </i:InvokeCommandAction>
  		</i:EventTrigger>
  	</i:Interaction.Triggers>
  <ListBox.ItemTemplate>
          ...
  ```

  

